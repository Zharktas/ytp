
{% import 'macros/form.html' as form %}

{# multilinqual input #}

{% macro language_select(id, name, locales, selected_locale, change=False) %}
    <select class="locale-select {% if change -%}locale-select-change{%- endif %}" id="{{ id or name }}" name="{{ name }}" style="position: absolute; width: 7em; right: -8em; top: 6px;">
    {% for locale in locales %}
        <option value="{{ locale }}" {% if selected_locale == locale %}selected="selected"{% endif %}>{{ locale.get_display_name() }}</option>
    {% endfor %}
    </select>
{% endmacro %}

{% macro input(name, id='', label='', value='', placeholder='', type='text', error="", classes=[], attrs={}, is_required=false, locales=[], selected_locale=none, data=none) %}
  {%- set extra_html = caller() if caller -%}

  {% call form.input_block(id or name, label or name, error, classes, extra_html=extra_html, is_required=is_required) %}
    <div style="position: relative;">
        <div style="position: relative;" class="ytp-locale-list">
            {{ language_select(id + "_locale", name + "_locale", locales, selected_locale) }}
            <input id="{{ id or name }}" type="{{ type }}" name="{{ name }}" value="{{ value | empty_and_escape }}" placeholder="{{ placeholder }}" {{ form.attributes(attrs) }} />
        </div>

        {% for locale in locales %}
        {% set locale_value = data[name + "_" + locale.language] %}
        {% if locale_value %}
            {% if not locale_value.append %}
                {% set locale_value = [locale_value] %}
            {% endif %}
            {% for locale_item in locale_value %}
            <div style="position: relative;">
                {{ language_select(id + "_locale_" + locale.language, name + "_locale_" + locale.language, locales, locale, change=true) }}
                <input id="{{ id or name }}_{{ locale }}" type="{{ type }}" name="{{ name }}_{{ locale }}" value="{{ locale_item | empty_and_escape }}" placeholder="{{ placeholder }}" {{ form.attributes(attrs) }} />
            </div>
            {% endfor %}
        {% endif %}
        {% endfor %}
    </div>
  {% endcall %}
{% endmacro %}

{% macro input_multiple(name, id='', label='', value='', placeholder='', type='text', error="", classes=[], attrs={}, is_required=false) %}
  {% resource 'ytp_common_js/ytp_form.js' %}
  {% do classes.append('control-medium') %}
  {%- set extra_html = caller() if caller -%}
  {% call form.input_block(id or name, label or name, error, classes, control_classes=["editor"], extra_html=extra_html, is_required=is_required) %}
    {% if value %}
      {% set values = value if value.append else [value] %}
      {% for value_item in values %}
        <input id="{{ id or name }}-{{ loop.counter }}" type="{{ type }}" name="{{ name }}" value="{{ value_item | empty_and_escape }}" placeholder="{{ placeholder }}" {{ form.attributes(attrs) }} />
      {% endfor %}
    {% endif %}
    <input id="{{ id or name }}" type="{{ type }}" name="{{ name }}" value="" placeholder="{{ placeholder }}" class="ytp-list" {{ form.attributes(attrs) }} />
  {% endcall %}
{% endmacro %}
