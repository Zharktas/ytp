{% extends "page.html" %}

{% block subtitle %}{{ _('Analytics for site') }}{% endblock %}

{% block breadcrumb_content %}
 <li class="active">{% link_for _('Analytics for this site'),  controller='ckanext.googleanalytics.controller:GAController', action='view' %}</li>
{% endblock %}

{% block secondary_content %}
  <section class="module module-narrow">
    <h2 class="module-heading"><i class="icon-large icon-info-sign"></i>{{ _('Site analytics summary') }}</h2>
    <div class="module-content">
      <p>
        {% trans -%}
        This page presents the most viewed and downloaded datasets. 
        Note that this data does not include API calls. 
        {%- endtrans %}
      </p>
    </div>
  </section>
{% endblock %}

{% block primary_content %}
  <section class="module">
  <div class="module-content">
  <h2>{% trans %}Most viewed datasets{% endtrans %}</h2> 
    {% if c.top_packages %}
    <table class="table table-condensed table-bordered table-striped">
	  <tr>
	    <th>{% trans %}Dataset{% endtrans %}</th>
	    <th>{% trans %}Unique views (last 14 days){% endtrans %}</th>
	    <th>{% trans %}Unique views (since recording started){% endtrans %}</th>
	  </tr>
      {% for toppackage in c.top_packages %}
	  <tr>
		<td>{{ h.link_to(toppackage.package.title or toppackage.package.name, h.url_for(controller='package', action='read', id=toppackage.package.name)) }}</td>
		<td>{{ toppackage.recent }}</td>
		<td>{{ toppackage.ever }}</td>
	   </tr>
      {% endfor %}
    </table>
    {% else %}
      <p>{% trans %}No analytics found for most downloaded datasets.{% endtrans %}</p>
    {% endif %}
    <h2>{% trans %}Most downloaded resources{% endtrans %}</h2> 
    {% if c.top_resources %}
       <table class="table table-condensed table-bordered table-striped">
	 <tr>
	   <th>{% trans %}Resource{% endtrans %}</th>
	   <th>{% trans %}Downloads (last 14 days{% endtrans %}</th>
	   <th>{% trans %}Downloads (since recording started){% endtrans %}</th>
	 </tr>
      {% for topresource in c.top_resources %}
	  <tr>
	     <td>{{ h.link_to(h.truncate(topresource.resource.description, length=50,whole_word=True) if topresource.resource.description else topresource.resource.format, h.url_for(controller='package',action='resource_read',id=topresource.resource.package.id,resource_id=topresource.resource.id)) }}<br />
	      <em>in {{ h.link_to(topresource.resource.package.title or topresource.resource.package.name, h.url_for(controller='package', action='read', id=topresource.resource.package.name)) }}</em>
	    </td>
      <td>{{ topresource.recent }}</td>
	    <td>{{ topresource.ever }}</td>
	  </tr>
	  {% endfor %}
	  </table>
	  {% else %}
      <p>{% trans %}No statistics found for most downloaded resources.{% endtrans %}</p>
       {% endif %}
    </div>
   </section>
{% endblock %}
