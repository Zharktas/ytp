---

# Forced maintenance leave is removed in future. Ontology import requires CKAN web API.
- name: Leave maintenance mode
  file: path="/var/www/maintenance" state=absent
  tags:
  - maintenance

- name: Import dataset tags
  shell: "{{ virtual_environment }}/bin/paster --plugin=ckanext-ytp-tasks ytp-task-add -c {{ ckan_ini }} --execute import_dataset_tags ckanext.ytp.dataset.tags_import manual '{\"ontology_url\": \"http://onki.fi/en/browser/downloadfile/juho?o=http%3A%2F%2Fwww.yso.fi%2Fonto%2Fjuho&f=juho%2Fyso%2Bvnas%2Beks%2Bveps160610a-ONKIIN.rdf-xml.owl\", \"meta_name\": \"z_avoindatafi_metadata\"}'"
  tags:
  - data
  - data-tags-celery

- name: Import organization types
  shell: "{{ virtual_environment }}/bin/paster --plugin=ckanext-ytp-tasks ytp-task-add -c {{ ckan_ini }} --execute import_organization_types ckanext.ytp.organizations.organization_type_import manual '{\"data_url\": \"http://api.finto.fi/rest/v1/jupo/data\",\"data_format\": \"n3\"}'"
  tags:
  - data
  - data-organization-types
  
- name: Import harvest organizations
  shell: "{{ virtual_environment }}/bin/paster --plugin=ckanext-ytp-tasks ytp-task-add -c {{ ckan_ini }} --wait=120 import_harvest_organizations ckanext.ytp.organizations.organization_import manual '{\"url\": \"https://raw2.github.com/yhteentoimivuuspalvelut/ytp-tools/master/organization_harvest.json\"}'"
  when: harvest_sources != False
  tags:
  - data
  - harvest

- name: Set harvest sources
  shell: "{{ virtual_environment }}/bin/paster --plugin=ckanext-harvest harvester --config={{ ckan_ini }} source {{ item.name }} {{ item.url }} ckan {{ item.title }} true {{ item.organization }} DAILY '{{ item.configuration }}'"
  with_items: harvest_sources
  when: harvest_sources != False
  ignore_errors: True
  tags:
  - data
  - non-local
  - harvest

- name: Import base organizations
  shell: "{{ virtual_environment }}/bin/paster --plugin=ckanext-ytp-tasks ytp-task-add -c {{ ckan_ini }} --execute import_base_organizations ckanext.ytp.organizations.organization_import manual '{\"url\": \"https://raw2.github.com/yhteentoimivuuspalvelut/ytp-tools/master/organization.json\"}'"
  tags:
  - data
